/* fichier CSS complet (remplace l'ancien) */

/* layout général */
body{ font-family: Arial, Helvetica, sans-serif; margin:0; padding:0; color:#222; background:#fff; }
.container{ max-width:1100px; margin:18px auto; padding:0 16px; }

/* CR sticky */
.cr-sticky-panel{
  position:sticky; top:0; z-index:1200;
  background:#f1f3f4; border-bottom:2px solid rgba(0,0,0,0.06);
  box-shadow:0 6px 18px rgba(0,0,0,0.06); padding:12px 18px;
  max-height:34vh; overflow:auto; transition:max-height .28s, padding .2s; border-radius:0 0 10px 10px;
}
.cr-sticky-panel.collapsed{ max-height:46px; overflow:hidden; padding-bottom:6px; }
#toggle-cr-panel{ position:absolute; right:12px; top:8px; border:0; background:#fff; padding:6px; border-radius:6px; cursor:pointer; box-shadow:0 1px 4px rgba(0,0,0,0.08); }

/* actions */
.actions-row{ margin-top:10px; display:flex; align-items:center; gap:8px; }
.btn-copier{ padding:8px 10px; border-radius:6px; border:0; background:#ddd; cursor:pointer; color:#fff; }
.btn-gen{ background:#5a8bd8; }
.copie-ok{ font-weight:700; color:#2a7f2a; }
.hidden{ display:none !important; }

/* Bulls container full width */
.bulls-container{ /* utiliser le panneau comme conteneur de la grille (pas flex) */
  width:100%;
  box-sizing:border-box;
  padding:14px;
  margin:8px auto;
}

/* bulls layout */
.bulls-grid{ display:grid; grid-template-columns:1fr 1fr; gap:18px; align-items:start; }
.bull-cell{ display:flex; flex-direction:column; gap:10px; }
.bull-cell h2{ margin:0; font-size:1.05rem; color:#183248; font-weight:700; }

/* svg sizing */
svg{ width:100%; height:auto; max-height:420px; border:1px solid #eee; background:#fff; border-radius:6px; }

/* legend under each bull */
.legend.under{ margin-top:8px; font-size:0.95rem; color:#333; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.legend-box{ display:inline-block; width:14px; height:12px; vertical-align:middle; border-radius:3px; }
.legend-box.green{ background:#27ae60; }
.legend-box.orange{ background:#f39c12; }
.legend-box.red{ background:#e74c3c; }

/* perf controls near bulls */
.perf-controls{ display:flex; flex-wrap:wrap; gap:10px; margin-top:8px; }
.perf-controls > div{ min-width:140px; }

/* fills classes (utilisées pour SVG) */
.fill-green{ fill:#27ae60 !important; fill-opacity:0.9 !important; }
.fill-orange{ fill:#f39c12 !important; fill-opacity:0.9 !important; }
.fill-red{ fill:#e74c3c !important; fill-opacity:0.9 !important; }

/* gris pour réversibilité inactif */
.fill-gray{ fill:#d9d9d9 !important; fill-opacity:0.95 !important; stroke:#bbb !important; }

/* classes utilitaires pour rev paths (évite inline styles) */
.rev-path{ cursor:pointer; }
.rev-active{ pointer-events:auto; opacity:1; transition:opacity .18s; }
.rev-inactive{ pointer-events:none; opacity:0.55; transition:opacity .18s; }

/* petites tables etc. */
.table-kine{ width:100%; border-collapse:collapse; margin-top:8px; }
.table-kine td{ padding:6px 8px; vertical-align:top; }
.flag{ font-size:0.9rem; color:#666; }
.fevg-auto{ font-weight:700; color:#2c7fb8; font-size:1rem; margin-top:6px; }

/* Restaurer rendu visuel des SVG "isch"/"nec" lorsqu'on les sélectionne */
.zone-bin{ fill: transparent; transition: fill .15s, fill-opacity .15s; }
.zone-bin.on{ fill: #3498db !important; /* bleu = segment inclus */ fill-opacity: 0.95 !important; stroke:#0b5fa8 !important; }
/* rendre les zones cliquables (CSP safe, évite style inline) */
.zone-svg,
.zone-bin,
.rev-path {
  fill: transparent; 
  transition: fill .15s, fill-opacity .15s;
  cursor: pointer;
  pointer-events: auto;
}

/* si nécessaire, forcer aussi au niveau des SVG */
svg .zone-svg,
svg .zone-bin,
svg .rev-path {
  cursor: pointer;
  pointer-events: auto;
}

/* Légendes et couleurs tri-état pour ischémie / nécrose (non = gris) */
.legend-box.isch-none   { background: #d9d9d9; }
.legend-box.isch-partial{ background: #f39c12; }
.legend-box.isch-complete{ background: #e74c3c; }

.legend-box.nec-none    { background: #d9d9d9; }
.legend-box.nec-partial { background: #f39c12; }
.legend-box.nec-complete{ background: #e74c3c; }

/* Zones SVG : par défaut transparent (CSS gère couleur via classes) */
.zone-svg,
.zone-bin,
.rev-path {
  fill: transparent; 
  transition: fill .15s, fill-opacity .15s;
  cursor: pointer;
  pointer-events: auto;
}

/* ISCHEMIE : override selon classe appliquée */
.zone-bin.isch-partial.on   { fill:#f39c12 !important; fill-opacity:0.92 !important; stroke:#b26b07 !important; }
.zone-bin.isch-complete.on  { fill:#e74c3c !important; fill-opacity:0.92 !important; stroke:#a4281a !important; }
.zone-bin.isch-none.on      { fill:#d9d9d9 !important; fill-opacity:0.95 !important; stroke:#bbb !important; }

/* NECROSE : override selon classe appliquée */
.zone-bin.nec-partial.on    { fill:#f39c12 !important; fill-opacity:0.92 !important; stroke:#b26b07 !important; }
.zone-bin.nec-complete.on   { fill:#e74c3c !important; fill-opacity:0.92 !important; stroke:#a4281a !important; }
.zone-bin.nec-none.on       { fill:#d9d9d9 !important; fill-opacity:0.95 !important; stroke:#bbb !important; }

/* fallback général si aucune classe spécifique */
.zone-bin.on { fill:#3498db !important; fill-opacity:0.95 !important; stroke:#0b5fa8 !important; }

/* petites badges/légendes (optionnel) */
.legend-badge { display:inline-block; min-width:26px; text-align:center; background:#fff; border-radius:12px; padding:2px 6px; border:1px solid rgba(0,0,0,0.06); font-weight:700; margin-left:6px; }

/* Overrides prioritaires par SVG pour restaurer les couleurs */
#svg-perfusion path.fill-green    { fill:#27ae60 !important; stroke:#1f8b47 !important; }
#svg-perfusion path.fill-orange   { fill:#f39c12 !important; stroke:#b26b07 !important; }
#svg-perfusion path.fill-red      { fill:#e74c3c !important; stroke:#a4281a !important; }

#svg-ischemie path.zone-bin.isch-partial.on  { fill:#f39c12 !important; stroke:#b26b07 !important; }
#svg-ischemie path.zone-bin.isch-complete.on { fill:#e74c3c !important; stroke:#a4281a !important; }
#svg-ischemie path.zone-bin.isch-none.on     { fill:#d9d9d9 !important; stroke:#bbb !important; }

#svg-necrose path.zone-bin.nec-partial.on    { fill:#f39c12 !important; stroke:#b26b07 !important; }
#svg-necrose path.zone-bin.nec-complete.on   { fill:#e74c3c !important; stroke:#a4281a !important; }
#svg-necrose path.zone-bin.nec-none.on       { fill:#d9d9d9 !important; stroke:#bbb !important; }

/* sécurité : garantir le curseur/pointer events sur les paths cliquables */
#svg-ischemie path, #svg-necrose path, #svg-perfusion path { cursor: pointer; pointer-events: auto; }

/* Empêche tout rect ou calque d'intercepter les clics */
#svg-reversibilite > rect { pointer-events: none; }

/* Clarifie le comportement pointer pour rev-path */
.rev-path { cursor: pointer; }
.rev-path.rev-active  { pointer-events: auto; cursor: pointer; opacity: 1; }
.rev-path.rev-inactive{ pointer-events: none; cursor: default; opacity: 0.55; }

/* conclusions pairées — deux bull-eyes côte à côte */
.conclusions-pair{ display:flex; gap:18px; align-items:flex-start; justify-content:space-between; margin:12px 8px; flex-wrap:wrap; }
.conclusion-block{ flex:1 1 48%; display:flex; gap:12px; align-items:flex-start; }
.conclusion-block .svg-panel{ flex:1 1 60%; }
.conclusion-block .table-panel{ flex:1 1 40%; min-width:220px; }

/* style pour selects territoire (uniforme) */
select[id*="territoire"]{ width:100%; padding:6px 8px; border-radius:6px; border:1px solid #ccc; background:#fff; }


/* Thème : fun & sérieux - neutre, aéré, moderne */

:root{
  --bg:#f6f9fc;
  --card:#ffffff;
  --muted:#6b7887;
  --accent:#2c7fb8;
  --accent-2:#1fa67a;
  --glass: rgba(15,35,60,0.06);
  --radius:10px;
  --gap:14px;
  --max-width:1200px;
  --shadow: 0 10px 30px rgba(15,35,60,0.06);
  --panel-border: rgba(30,60,100,0.04);
  font-family: "Inter", "Segoe UI", Roboto, Arial, sans-serif;
}

/* Reset & layout */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:18px;
  background:linear-gradient(180deg,var(--bg),#ffffff);
  color:#223244;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  font-size:15px;
  line-height:1.35;
}

/* page container centering */
.container, .bulls-container, .layout, .conclusions-pair{
  max-width:var(--max-width);
  margin:0 auto 18px;
}

/* Panels */
.panel{
  background:var(--card);
  border-radius:var(--radius);
  padding:16px;
  box-shadow:var(--shadow);
  border:1px solid var(--panel-border);
}

/* Form grid */
.form-grid{
  display:grid;
  gap:var(--gap);
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  align-items:end;
}

/* Labels & selects uniformisés */
label{ display:block; font-weight:600; color:#2b3b4a; margin-bottom:6px; font-size:0.95rem; }
select, input[type="number"]{
  width:100%;
  padding:9px 12px;
  border-radius:10px;
  border:1px solid #e1e9f5;
  background:linear-gradient(#ffffff,#f7fbff);
  font-size:0.95rem;
  color:var(--muted);
  outline:none;
  transition:box-shadow .12s, border-color .12s;
  -webkit-appearance:none;
  appearance:none;
}
select:focus, input[type="number"]:focus{
  box-shadow:0 6px 20px rgba(44,127,184,0.08);
  border-color:var(--accent);
  color:#123245;
}

/* add a subtle dropdown arrow for selects */
select{
  background-image: linear-gradient(45deg, transparent 50%, var(--muted) 50%), linear-gradient(135deg, var(--muted) 50%, transparent 50%);
  background-position: calc(100% - 18px) calc(1em + 2px), calc(100% - 12px) calc(1em + 2px);
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;
  padding-right:42px;
}

/* CR sticky panel (à droite) */
.cr-sticky-panel{
  position:fixed;
  right:18px;
  top:18px;
  width:320px;
  max-width:35%;
  z-index:1200;
  border-radius:10px;
  overflow:hidden;
  background:linear-gradient(180deg,#ffffff,#f8fbff);
  box-shadow:0 18px 50px rgba(12,30,60,0.12);
  border:1px solid rgba(20,40,80,0.06);
}
.cr-sticky-panel .cr-zone{
  padding:12px;
  min-height:96px;
  max-height:360px;
  overflow:auto;
  font-size:0.95rem;
  color:#213241;
}
.cr-sticky-panel .actions-row{
  display:flex;
  gap:8px;
  align-items:center;
  padding:10px;
  border-top:1px solid rgba(0,0,0,0.04);
  background:linear-gradient(180deg,rgba(250,250,255,0.6),transparent);
}
.btn-copier{
  background:linear-gradient(180deg,var(--accent),#1f6fa6);
  color:#fff;
  border:none;
  padding:8px 10px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  box-shadow:0 6px 18px rgba(47,114,170,0.12);
}
.btn-gen{ background:linear-gradient(180deg,var(--accent-2),#148b67); }
.btn-copier:active{ transform:translateY(1px) }

/* SVG sizes uniforme */
.bull-svg{ width:100%; height:360px; max-height:360px; min-height:320px; border-radius:8px; background:#fff; border:1px solid #eef3f8; }
.svg-panel svg{ width:100%; height:320px; max-height:320px; }

/* Controls below bull-eyes */
.bulls-controls{ display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:12px; margin-top:14px; padding-top:12px; border-top:1px dashed rgba(20,40,80,0.03); }
.perf-controls > div{ min-width:140px; }

/* table kine */
.table-panel h2{ margin-top:0; font-size:1.05rem; color:#183248; }
.table-kine{ width:100%; border-collapse:collapse; margin-top:12px; font-size:0.95rem; }
.table-kine td{ padding:8px 10px; vertical-align:top; }
.lbl{ font-weight:700; color:#213241; width:18%; }
.center{ text-align:center; }
.colhead td{ font-weight:700; color:var(--muted); background:transparent; }

/* slider group & small values */
.slider-group{ display:flex; gap:8px; align-items:center; }
.slider-group input[type="number"]{ width:110px; }
.slider-group span{ color:var(--muted); font-size:0.92rem; }

/* flags */
.flag{ font-size:0.9rem; color:var(--muted); }

/* fevg auto highlight */
.fevg-auto{ font-weight:800; color:var(--accent); font-size:1.05rem; padding:6px 8px; border-radius:8px; background:linear-gradient(90deg,rgba(44,127,184,0.06),transparent); display:inline-block; }

/* conclusions pair */
.conclusions-pair{ display:grid; grid-template-columns:1fr 1fr; gap:18px; }
.conclusion-block .svg-panel{ padding:12px; }

/* legend boxes */
.legend{ font-size:0.95rem; color:#2b3b4a; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.legend .legend-box{ display:inline-block; width:14px; height:14px; border-radius:3px; margin-right:6px; border:1px solid rgba(0,0,0,0.06); }
.legend .green{ background:#26a65b }
.legend .orange{ background:#ff9a3c }
.legend .red{ background:#e53935 }
.legend .blue{ background:#2b7be6 }

/* --- Top row : form 70% + mini CR 30% (sticky) --- */
.top-row{ display:block; gap:16px; margin-bottom:12px; position:relative; }
.top-left{ width:100%; box-sizing:border-box; }

/* CR mini fixe à droite — 30% de la fenêtre en hauteur, toujours en haut */
.top-right{ /* conteneur logique, le .cr-mini sera fixé */ }
.cr-mini{
  position:fixed;
  left:0;
  right:0;
  top:0;                   /* toujours collé en haut */
  width:100%;              /* <-- prend 100% de la largeur */
  max-width:none;
  z-index:1400;
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:12px 20px;
  height:30vh;             /* <-- 30% de la hauteur de la fenêtre */
  max-height:30vh;
  box-sizing:border-box;
  overflow:auto;
  background:linear-gradient(180deg,#ffffff,#fbfdff);
  border-radius:0 0 10px 10px; /* arrondir uniquement le bas */
  border-bottom:1px solid rgba(30,60,100,0.06);
  box-shadow:0 8px 30px rgba(12,30,60,0.08);
}

/* Eviter que le contenu sous-jacent soit masqué par la barre fixe */
body{
  padding-top: calc(30vh + 28px); /* ajuste selon ton spacing (30vh + marge) */
}

/* retirer le padding-right utilisé précédemment pour le CR à droite */
.container { padding-right: 16px; }
/* ...existing code... */

/* petite optimisation : sur petits écrans garder la barre fixe en haut, mais pleine largeur */
@media (max-width:1000px){
  .cr-mini{
    left:0;
    right:0;
    top:0;
    width:100%;
    height:30vh;
    max-height:30vh;
    border-radius:0 0 8px 8px;
  }
  .container { padding-right:16px; padding-top: calc(30vh + 28px); }
}

/* responsive adjustments */
@media(max-width:1000px){
  .top-row{ flex-direction:column; }
  .top-right{ max-width:100%; position:static; }
  .bulls-grid{ grid-template-columns:1fr; }
  .conclusions-pair{ grid-template-columns:1fr; }
}

/* responsive */
@media (max-width:1000px){
  .bulls-grid{ grid-template-columns:1fr; }
  .conclusions-pair{ grid-template-columns:1fr; }
  .cr-sticky-panel{ position:fixed; left:50%; transform:translateX(-50%); top:auto; bottom:12px; width:92%; max-width:680px; }
}

/* Conclusions : 2 colonnes; chaque colonne empile svg puis controls */
.conclusions-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px;
  align-items:start;
}
.conclusion-column{
  display:flex;
  flex-direction:column;
  gap:12px;
}
.conclusion-column .svg-panel{ order:0; }
.conclusion-column .table-panel{ order:1; }

/* responsive : empile sur petit écran */
@media(max-width:1000px){
  .conclusions-grid{ grid-template-columns:1fr; }
}

/* petites finitions */
.footer{ text-align:center; color:var(--muted); font-size:0.9rem; margin:18px 0 28px; }
.hidden{ display:none; }
/* --- Uniformisation conclusions = mêmes règles que bulls-container/bulls-grid --- */
.conclusions-container{ padding:14px; } /* si besoin d'un padding dédié */

/* légendes spécifiques pour Ischémie (gris / orange / rouge) */
.legend-box.isch-none     { background:#e9eef3; border:1px solid rgba(0,0,0,0.06); } /* gris clair */
.legend-box.isch-partial  { background:#f39c12; }
.legend-box.isch-complete { background:#e74c3c; }

/* légendes spécifiques pour Nécrose (dégradé de gris) */
.legend-box.nec-none      { background:#d6d8db !important; border:1px solid rgba(0,0,0,0.06) !important; } /* gris clair */
.legend-box.nec-partial   { background:#7a8086 !important; } /* gris moyen */
.legend-box.nec-complete  { background:#303234 !important; } /* gris foncé */

/* Etat par défaut du bull-eye nécrose : gris clair (comme reversibilité) */
#svg-necrose path.zone-bin {
  fill:#eceff1 !important;
  fill-opacity:0.95 !important;
  stroke:#c0c7cc !important;
}

/* Couleurs appliquées quand on clique (classes .nec-xxx.on) — nuances de gris prononcées */
#svg-necrose path.zone-bin.nec-none.on {
  fill:#d6d8db !important;
  stroke:#bfc6cb !important;
  fill-opacity:0.98 !important;
}
#svg-necrose path.zone-bin.nec-partial.on {
  fill:#9aa0a6 !important;
  stroke:#7a8086 !important;
  fill-opacity:0.96 !important;
}
#svg-necrose path.zone-bin.nec-complete.on {
  fill:#50555a !important;
  stroke:#303234 !important;
  fill-opacity:0.98 !important;
}

/* Garantir priorité sur d'autres sélecteurs */
.zone-bin.nec-none.on     { fill:#d6d8db !important; stroke:#bfc6cb !important; }
.zone-bin.nec-partial.on  { fill:#9aa0a6 !important; stroke:#7a8086 !important; }
.zone-bin.nec-complete.on { fill:#50555a !important; stroke:#303234 !important; }

/* base des conclusion-bull-eyes : chemins gris clair par défaut (comme reversibilité) */
#svg-ischemie path.zone-bin,
#svg-necrose path.zone-bin {
  fill: transparent; /* laisser JS gérer mais fallback */
  stroke:#777;
  transition: fill .15s, fill-opacity .15s;
}

/* forcer look "gris clair" via .fill-gray (appliquée dans HTML initial) */
.fill-gray { fill:#eceff1 !important; fill-opacity:0.95 !important; stroke:#c0c7cc !important; }

/* priorité : quand JS active isch/nec (classe .on + isch-partial / isch-complete / nec-partial / nec-complete),
   les règles suivantes prennent le dessus (déjà présentes mais on répète la spécificité pour sécurité) */
#svg-ischemie path.zone-bin.isch-partial.on  { fill:#f39c12 !important; stroke:#b26b07 !important; fill-opacity:0.92 !important; }
#svg-ischemie path.zone-bin.isch-complete.on { fill:#e74c3c !important; stroke:#a4281a !important; fill-opacity:0.92 !important; }
#svg-ischemie path.zone-bin.isch-none.on     { fill:#e9eef3 !important; stroke:#c0c7cc !important; fill-opacity:0.95 !important; }

#svg-necrose path.zone-bin.nec-partial.on    { fill:#7a8086 !important; stroke:#7a8086 !important; fill-opacity:0.92 !important; }
#svg-necrose path.zone-bin.nec-complete.on   { fill:#303234 !important; stroke:#303234 !important; fill-opacity:0.92 !important; }
#svg-necrose path.zone-bin.nec-none.on       { fill:#f3f5f7 !important; stroke:#dcdfe3 !important; fill-opacity:0.95 !important; }

/* garantir l'uniformité d'espacement identique à la section perfusion */
.bulls-container.conclusions-container .bulls-grid,
.bulls-container .bulls-grid,
.conclusions-container .bulls-grid {
  gap:18px;
  align-items:start;
}

/* s'assurer que panels / svg ont même hauteur / padding que perfusion */
.bulls-container.conclusions-container .bull-svg,
.bulls-container .bull-svg { min-height:320px; max-height:360px; }

